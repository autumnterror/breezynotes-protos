syntax = "proto3";
package auth;

option go_package = "github.com/autumnterror/breezynotes-protos;authrpc1";

// --- AUTH SERVICE ---
// Authentication and JWT
service AuthService {
  rpc Authenticate(AuthenticationRequest) returns (Message);           // AuthRepo.Authentication
  rpc GenerateTokens(GenerateTokensRequest) returns (TokensResponse); // WithConfigRepo.GenerateToken
  rpc VerifyToken(VerifyTokenRequest) returns (TokenInfo);            // WithConfigRepo.VerifyToken + extract info
  rpc RefreshToken(RefreshTokenRequest) returns (AccessToken);        // WithConfigRepo.Refresh
}

// --- USER SERVICE ---
// Full user management
service UserService {
  rpc CreateUser(UserRequest) returns (Message);                      // UserRepo.Create
  rpc UpdateUser(UserRequest) returns (Message);                      // UserRepo.Update
  rpc UpdatePassword(UpdatePasswordRequest) returns (Message);        // UserRepo.UpdatePassword
  rpc UpdateEmail(UpdateEmailRequest) returns (Message);              // UserRepo.UpdateEmail
  rpc UpdateLogin(UpdateLoginRequest) returns (Message);              // UserRepo.UpdateLogin
  rpc UpdateAbout(UpdateAboutRequest) returns (Message);              // UserRepo.UpdateAbout
  rpc DeleteUser(ByIdRequest) returns (Message);                      // UserRepo.Delete
  rpc GetUserInfo(ByIdRequest) returns (UserInfo);                    // UserRepo.GetInfo
  rpc CheckUserExists(CheckUserExistsRequest) returns (Message);      // UserRepo.CheckUserExists
}

// --- MESSAGES ---

message AuthenticationRequest {
  string login = 1;
  string email = 2;
  string password = 3;
}

message GenerateTokensRequest {
  string id = 1;
}

message VerifyTokenRequest {
  string token = 1;
}

message RefreshTokenRequest {
  string refresh_token = 1;
}

message TokensResponse {
  string access_token = 1;
  string refresh_token = 2;
}

message AccessToken {
  string access_token = 1;
}

message TokenInfo {
  string id = 1;
  string type = 2;
}

message Message {
  string message = 1;
}

message UserRequest {
  string id = 1;
  string login = 2;
  string email = 3;
  string password = 4;
  string about = 5;
}

message UpdatePasswordRequest {
  string id = 1;
  string new_password = 2;
}

message UpdateEmailRequest {
  string id = 1;
  string email = 2;
}

message UpdateLoginRequest {
  string id = 1;
  string login = 2;
}

message UpdateAboutRequest {
  string id = 1;
  string about = 2;
}

message ByIdRequest {
  string id = 1;
}

message CheckUserExistsRequest {
  string login = 1;
  string email = 2;
}

message UserInfo {
  string login = 1;
  string email = 2;
  string about = 3;
}
